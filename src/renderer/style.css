/* --- Base & Variables --- */
:root {
    /* Glassmorphism Palette (using black/white with alpha) */
    --bg-color-rgb: 30, 30, 30; /* Base dark background */
    --glass-bg-rgb: 45, 45, 45; /* Slightly lighter for glass */
    --glass-border-rgb: 80, 80, 80;
    --glass-alpha: 0.65; /* Adjust alpha for desired transparency */
    --blur-amount: 12px; /* Adjust blur intensity */

    --text-color: #e8e8e8;
    --text-color-secondary: #a0a0a0;
    --accent-color: #007aff; /* iOS-like blue */
    --accent-hover: #0056b3;
    --user-msg-bg: var(--accent-color);
    --assistant-msg-bg-rgb: 60, 60, 60;
    --assistant-msg-alpha: 0.75;
    --error-color: #ff3b30; /* iOS-like red */
    --listening-color: #34c759; /* iOS-like green */
    --awaiting-input-color: #ff9500; /* iOS-like orange for waiting */

    --border-radius: 12px; /* More rounded corners */
    --border-radius-small: 8px;
    --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    --transition-speed: 0.2s;
}

/* ... (Reset styles *, *::before, *::after, html, body remain same) ... */
html, body {
    height: 100%;
    overflow: hidden;
    font-family: var(--font-family);
    background-color: transparent;
    color: var(--text-color);
}
body {
    opacity: 0;
    transform: scale(0.98) translateY(10px);
    transition: opacity 0.4s ease-out, transform 0.4s ease-out;
}
body.loaded { opacity: 1; transform: scale(1) translateY(0); }


/* --- Container & Layout --- */
.container {
    height: 100%;
    display: flex;
    flex-direction: column;
    border-radius: var(--border-radius);
    overflow: hidden;
    background-color: rgba(var(--bg-color-rgb), var(--glass-alpha));
    backdrop-filter: blur(var(--blur-amount));
    -webkit-backdrop-filter: blur(var(--blur-amount));
    border: 1px solid rgba(var(--glass-border-rgb), 0.5);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

/* --- Custom Title Bar --- */
.title-bar {
    display: flex;
    align-items: center;
    padding: 0;
    background-color: rgba(var(--glass-bg-rgb), 0.4);
    backdrop-filter: blur(calc(var(--blur-amount) / 2));
    -webkit-backdrop-filter: blur(calc(var(--blur-amount) / 2));
    border-bottom: 1px solid rgba(var(--glass-border-rgb), 0.3);
    height: 40px;
    flex-shrink: 0;
}
.title-bar-drag-area {
    flex-grow: 1;
    height: 100%;
    display: flex;
    align-items: center;
    padding-left: 15px;
    -webkit-app-region: drag;
    user-select: none;
}
.title { font-weight: 600; font-size: 0.9em; color: var(--text-color); }
.window-controls { display: flex; height: 100%; -webkit-app-region: no-drag; }
.window-controls button {
    background: none; border: none; color: var(--text-color-secondary);
    font-size: 1.1em; padding: 0 14px; height: 100%; cursor: pointer;
    transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
    font-weight: bold; line-height: 40px;
}
.window-controls button:hover { background-color: rgba(255, 255, 255, 0.1); color: var(--text-color); }
#clear-chat-btn { font-size: 1.2em; padding: 0 12px; }
#clear-chat-btn:hover { color: var(--accent-color); }
#close-btn:hover { background-color: var(--error-color); color: white; }

/* --- Chat Area --- */
.chat-container { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
.chat-container::-webkit-scrollbar { width: 6px; }
.chat-container::-webkit-scrollbar-track { background: transparent; }
.chat-container::-webkit-scrollbar-thumb { background-color: rgba(var(--glass-border-rgb), 0.5); border-radius: 3px; }
.chat-container::-webkit-scrollbar-thumb:hover { background-color: rgba(var(--glass-border-rgb), 0.8); }

.message {
    padding: 10px 15px; border-radius: var(--border-radius); max-width: 85%;
    word-wrap: break-word; line-height: 1.5; position: relative; opacity: 0;
    transform: translateY(10px); animation: messageSlideIn 0.3s ease-out forwards;
    border: 1px solid transparent; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}
@keyframes messageSlideIn { to { opacity: 1; transform: translateY(0); } }
.message.user { background-color: var(--user-msg-bg); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
.message.assistant {
    background-color: rgba(var(--assistant-msg-bg-rgb), var(--assistant-msg-alpha));
    backdrop-filter: blur(calc(var(--blur-amount) / 3));
    -webkit-backdrop-filter: blur(calc(var(--blur-amount) / 3));
    border: 1px solid rgba(var(--glass-border-rgb), 0.4);
    color: var(--text-color); align-self: flex-start; border-bottom-left-radius: 4px;
}
.message a { color: var(--accent-color); text-decoration: none; word-break: break-all; }
.message a:hover { text-decoration: underline; }
.message pre { background-color: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: var(--border-radius-small); margin: 8px 0; overflow-x: auto; border: 1px solid rgba(var(--glass-border-rgb), 0.3); }
.message code { font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 0.9em; color: #f0f0f0; }
.message pre code { background: none; padding: 0; }
.message :not(pre) > code { background-color: rgba(0, 0, 0, 0.2); padding: 2px 4px; border-radius: 4px; font-size: 0.85em; }
.message img { max-width: 100%; border-radius: var(--border-radius-small); margin-top: 8px; display: block; }
.message.error {
    background-color: rgba(255, 59, 48, 0.7); color: white; align-self: center;
    text-align: center; border-color: rgba(255, 59, 48, 0.9);
    backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px);
}
.message.assistant.thinking { position: relative; overflow: hidden; }
.message.assistant.thinking::after {
     content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
     background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
     animation: thinkingLine 1.5s linear infinite;
}
@keyframes thinkingLine { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }

/* --- Interaction Area --- */
.interaction-area {
    padding: 12px 15px; border-top: 1px solid rgba(var(--glass-border-rgb), 0.3);
    background-color: rgba(var(--glass-bg-rgb), 0.5);
    backdrop-filter: blur(calc(var(--blur-amount) * 0.8));
    -webkit-backdrop-filter: blur(calc(var(--blur-amount) * 0.8));
    flex-shrink: 0; position: relative;
    transition: background-color var(--transition-speed) ease; /* For generating/awaiting bg change */
}

/* -- Style for awaiting input -- */
.interaction-area.awaiting-input {
     background-color: rgba(var(--awaiting-input-color), 0.1); /* Subtle orange tint */
}

.input-wrapper {
    display: flex; align-items: flex-end; gap: 8px; margin-bottom: 10px;
    background-color: rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(var(--glass-border-rgb), 0.4);
    border-radius: var(--border-radius); padding: 5px;
    transition: border-color var(--transition-speed) ease;
}
.input-wrapper:focus-within { border-color: rgba(var(--accent-color), 0.8); }
.interaction-area.awaiting-input .input-wrapper {
    border-color: rgba(var(--awaiting-input-color), 0.8); /* Orange border when waiting */
}


#query-input {
    flex-grow: 1; background-color: transparent; color: var(--text-color); border: none;
    border-radius: var(--border-radius-small); padding: 8px 10px; font-size: 1em;
    font-family: var(--font-family); resize: none; min-height: 38px; max-height: 120px;
    line-height: 1.4; outline: none;
    scrollbar-width: thin; scrollbar-color: rgba(var(--glass-border-rgb), 0.5) transparent;
}
#query-input::-webkit-scrollbar { width: 5px; }
#query-input::-webkit-scrollbar-track { background: transparent; }
#query-input::-webkit-scrollbar-thumb { background-color: rgba(var(--glass-border-rgb), 0.5); border-radius: 3px; }
#query-input::placeholder {
    color: var(--text-color-secondary);
    opacity: 0.8;
}


.interaction-area button {
    background-color: rgba(var(--glass-border-rgb), 0.3); color: var(--text-color-secondary);
    border: 1px solid transparent; border-radius: var(--border-radius-small); cursor: pointer;
    transition: all var(--transition-speed) ease; font-size: 1.4em; width: 38px; height: 38px;
    flex-shrink: 0; display: flex; justify-content: center; align-items: center;
}
.interaction-area button:hover { background-color: rgba(var(--glass-border-rgb), 0.5); color: var(--text-color); }
.interaction-area button:active { transform: scale(0.95); background-color: rgba(var(--glass-border-rgb), 0.6); }
.interaction-area button.disabled,
.interaction-area button:disabled { opacity: 0.5; cursor: not-allowed; pointer-events: none; }


#send-button { background-color: var(--accent-color); color: white; border: none; }
#send-button:hover { background-color: var(--accent-hover); }
/* Style send button when awaiting input to maybe indicate submission */
.interaction-area.awaiting-input #send-button {
     background-color: var(--awaiting-input-color);
}
.interaction-area.awaiting-input #send-button:hover {
    background-color: darken(var(--awaiting-input-color), 10%); /* Darker orange on hover */
}

.action-buttons { display: flex; justify-content: flex-start; gap: 10px; }

/* Specific Button States */
#mic-button.listening { background-color: var(--listening-color); color: white; animation: pulse var(--transition-speed) infinite alternate; }
@keyframes pulse { from { box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7); } to { box-shadow: 0 0 0 5px rgba(52, 199, 89, 0); } }
#webcam-button.active { background-color: var(--error-color); color: white; }

/* Stop Button */
.stop-button {
    position: absolute; top: -45px; left: 50%; transform: translateX(-50%);
    background-color: rgba(var(--error-color), 0.8); color: white;
    border: 1px solid rgba(255, 255, 255, 0.2); border-radius: var(--border-radius-small);
    padding: 5px 15px; font-size: 0.85em; width: auto; height: auto;
    backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); opacity: 0;
    transition: opacity var(--transition-speed) ease, top var(--transition-speed) ease;
    pointer-events: none; z-index: 10;
}
.stop-button:not(.hidden) { opacity: 1; top: -40px; pointer-events: auto; }
.stop-button:hover { background-color: rgba(var(--error-color), 1.0); }

/* --- Status Indicator --- */
.status-indicator {
    position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%);
    background-color: rgba(0, 0, 0, 0.7); color: white; padding: 5px 15px;
    border-radius: 15px; font-size: 0.8em; opacity: 0; transition: opacity 0.3s ease;
    pointer-events: none; z-index: 20; white-space: nowrap;
}
.status-indicator.show { opacity: 1; }